<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.company.mapper.BoardMapper">
  <!-- READ -->
  <select id="findAll" resultType="Board">
    SELECT * FROM board
  </select>
  <select id="findQueriedPage"  resultType="Board">
    select * from
    ( select rownum as rn, b.*
       from (
        select * from board
        <if test='query != null and query != ""
          and category != null and category != ""'>
          where LOWER(${category}) like '%'||LOWER(#{query})||'%'
        </if>
        order by idx desc
      ) b where rownum &lt; #{endIdx}
    ) where rn &gt;= #{startIdx}
  </select>
  <select id="countBoard" resultType="int">
    select count(idx) from board
    <if test='query != null and query != ""
          and category != null and category != ""'>
      where LOWER(${category}) like '%'||LOWER(#{query})||'%'
    </if>
  </select>
  
  <select id="findByIdx" parameterType="long" resultType="Board">
    SELECT * FROM board where idx = #{idx}
  </select>
  
  
  <!-- CREATE, UPDATE, DELETE -->
  <insert id="write" parameterType="Board">
    <selectKey keyProperty="idx" resultType="long" order="BEFORE">
      SELECT seq_board.nextval FROM dual
    </selectKey>
    INSERT INTO board (idx, title, content, writer)
    values (#{idx}, #{title}, #{content}, #{writer})
  </insert>
  <update id="update" parameterType="Board">
    UPDATE board SET
    title = #{title},
    content = #{content},
    updatedate = sysdate
    WHERE idx = #{idx}
  </update>
  <delete id="delete" parameterType="long">
    DELETE FROM board where idx = #{idx}  
  </delete>

</mapper>